<!DOCTYPE html>
<!-- saved from url=(0030)http://djbeng.com/yamseng.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!-- Global site tag (gtag.js) - Google Analytics -->
<script type="text/javascript" async="" src="./yamseng v0.5_files/analytics.js"></script><script async="" src="./yamseng v0.5_files/js"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-179392097-1');
</script>
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>yamseng v0.5</title>
  <link rel="apple-touch-icon" href="http://djbeng.com/yamsengmask-touch-icon.png">
  <link rel="icon" sizes="180x180" href="http://djbeng.com/yamsengmask-touch-icon.png">
<style shopback-extension-v5-6-5="" data-styled-version="4.2.0"></style><style shopback-extension-v6-2-5="" data-styled-version="4.2.0"></style></head>

<body class="vsc-initialized" cz-shortcut-listen="true">
<script>

var context;
var gainNode;
var yamBuffer = null;
var sengBuffer = null;
var ymymymBuffer = null;
var yamSource = null;
var sengSource = null;
var ymymymSource = null;
var yamming;
var ymymyming;
var yamcount = 0;
var pitch = 1.0;
var sleepcount;
var hiddendiv;

window.addEventListener('load', init, false);

function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

async function init() {
	try {
		// Fix up for prefixing
		window.AudioContext = window.AudioContext || window.webkitAudioContext;
		context = new AudioContext();
		gainNode = context.createGain();
		gainNode.connect(context.destination);
	} catch (e) {
		alert('Web Audio API is not supported in this browser');
	}

	loadyam("yam.mp3");
	loadseng("seng.mp3");
	loadymymym("ymymym.mp3");

    //wait up to 10 seconds for the mp3's to load
    sleepcount=0;
	while (sleepcount<100)
	{
		await sleep(100);
		sleepcount=sleepcount+1;
		if ((yamBuffer!=null)&&(sengBuffer!=null)&&(ymymymBuffer!=null)) sleepcount=100;
	}

	var el = document.getElementById("yamsengpad");
	el.addEventListener("touchstart", handleStart, false);
	el.addEventListener("touchend", handleEnd, false);
	el.addEventListener("touchcancel", handleCancel, false);
	el.addEventListener("touchmove", handleMove, false);
	el.addEventListener("touchforcechange", handleForceChange, false);
    el.style.display=""; //unhide yamsengpad only after mp3s loaded
	yamming = 0;
	ymymyming = 0;
}

function loadyam(url) {
	var request = new XMLHttpRequest();
	request.open('GET', url, true);
	request.responseType = 'arraybuffer';

	// Decode asynchronously
	request.onload = function() {
		context.decodeAudioData(request.response, function(buffer) {
			yamBuffer = buffer;
		}, function(error) {
			console.error('decodeAudioData error', error);
		});
	}
	request.send();
}

function loadseng(url) {
	var request = new XMLHttpRequest();
	request.open('GET', url, true);
	request.responseType = 'arraybuffer';

	// Decode asynchronously
	request.onload = function() {
		context.decodeAudioData(request.response, function(buffer) {
			sengBuffer = buffer;
		}, function(error) {
			console.error('decodeAudioData error', error);
		});
	}
	request.send();
}

function loadymymym(url) {
	var request = new XMLHttpRequest();
	request.open('GET', url, true);
	request.responseType = 'arraybuffer';

	// Decode asynchronously
	request.onload = function() {
		context.decodeAudioData(request.response, function(buffer) {
			ymymymBuffer = buffer;
		}, function(error) {
			console.error('decodeAudioData error', error);
		});
	}
	request.send();
}

function playSound(buffer,pitch) {
	var source = context.createBufferSource(); // creates a sound source
	source.buffer = buffer; // tell the source which sound to play
	source.playbackRate.value=pitch;
	source.connect(gainNode);
	gainNode.gain.value = 1.0;
	if (context.state=="suspended" || context.state=="interrupted") context.resume();
	source.start(0); // play the source now
	return source;
}

function stopSound(source){
	if ((source!=null)&&(source.playbackState==source.PLAYING_STATE))
		source.stop(0);
}

function handleStart(evt) {
	evt.preventDefault();

	if (yamming == 0) {
		yamcount = yamcount + 1;
		pitch=1.0;
		if (yamcount > 5) pitch = 0.875 + (Math.random() / 4.0);

		unmute2(context);
		stopSound(sengSource);
		stopSound(yamSource);
		yamSource = playSound(yamBuffer,pitch);
		yamming = 1;
		
		//reset ymymyming just to play safe
		if ((evt.touches.length < 2) && (ymymyming == 1)) {
			stopSound(ymymymSource);
			ymymyming = 0;
		}
	}

	if ((evt.touches.length > 1) && (ymymyming == 0)) //more than one finger ymymym
	{
		var ymymympitch=1.0;
		if (yamcount > 5) ymymympitch= 0.875 + (Math.random() / 4.0);
		ymymymSource = playSound(ymymymBuffer,ymymympitch);
		ymymyming = 1;
	}

}

async function handleEnd(evt) {
	evt.preventDefault();

	if ((evt.touches.length < 2) && (ymymyming == 1)) {
		stopSound(ymymymSource);
		ymymyming = 0;
	}

	if (evt.touches.length == 0) //all fingers lifted off
	{
		yamming = 0;
		if (yamming==0 && gainNode!=null) 
			{gainNode.gain.value = 0.50;await sleep(100);}
		if (yamming==0 && gainNode!=null) 
			{gainNode.gain.value = 0.25;await sleep(100);}
		if (yamming==0 && gainNode!=null) 
			{gainNode.gain.value = 0;await sleep(100);}

		if (yamming==0) stopSound(yamSource);
		if (yamming==0 && gainNode!=null) gainNode.gain.value = 1.0;
		if (yamming==0) sengSource = playSound(sengBuffer,pitch);
	}
}

function handleCancel(evt) {
	evt.preventDefault();
}

function handleMove(evt) {
	evt.preventDefault();
}

function handleForceChange(evt) {
	evt.preventDefault();
}

function unmute2(context) {
	// a hack to enable sound even when on silent mode on iPhone
	var ua = navigator.userAgent.toLowerCase();
	var isiphone = ua.indexOf("iphone") >= 0 && ua.indexOf("like iphone") < 0;
	var isipad = ua.indexOf("ipad") >= 0 && ua.indexOf("like ipad") < 0;
	var isipod = ua.indexOf("ipod") >= 0 && ua.indexOf("like ipod") < 0;
	if (isiphone || isipad || isipod) {
		if (hiddendiv==null) {
			hiddendiv = document.createElement("div");
			hiddendiv.innerHTML = "<audio x-webkit-airplay='deny'></audio>";
			var hiddentag = hiddendiv.children.item(0);
			hiddentag.controls = false;
			hiddentag.disableRemotePlayback = true;
			hiddentag.preload = "auto";
			// 0.01 seconds of silence
			hiddentag.src = "data:audio/mpeg;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA//////////////////////////////////////////////////////////////////8AAABhTEFNRTMuMTAwA8MAAAAAAAAAABQgJAUHQQAB9AAAAnGMHkkIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//sQxAADgnABGiAAQBCqgCRMAAgEAH///////////////7+n/9FTuQsQH//////2NG0jWUGlio5gLQTOtIoeR2WX////X4s9Atb/JRVCbBUpeRUq//////////////////9RUi0f2jn/+xDECgPCjAEQAABN4AAANIAAAAQVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==";
			hiddentag.loop = true;
			hiddentag.load();
		}
		hiddendiv.children.item(0).play();
	}
}

</script>

<table id="yamsengpad" style="height: 75%; width: 80%; position: absolute; top: 10%; left: 10%; border: 5px solid black;">
     <tbody><tr>
        <td>
          <div style="font-family:Helvetica,Arial,sans-serif;font-size:13vw;text-align:center">
YAAAAAM<br>seng
</div>
        </td>
    </tr>

</tbody></table>

<table id="arrow" style="height:5%;width:15%;position:absolute;top:90%;left:75%;">
	<tbody><tr><td>
<div style="font-family:Helvetica,Arial,sans-serif;font-size:5vw;text-align:center">
ℹ ↓
</div>
</td></tr>
</tbody></table>

<table id="qr" style="height:90%;width:90%;position:absolute;top:110%;left: 5%;">
<tbody><tr><td>
<div style="font-family: Helvetica,Arial,sans-serif; font-size:4vw;text-align:center">
<b>Use this app to yamseng while safely distancing!</b><br>
<br>
<b>Instructions:</b><br>
1 finger press to yaaaam,<br>
2 fingers to yamyamyam,<br>
release all fingers to seng<br>
after 5 yamsengs the pitch<br>
starts to vary randomly<br>
<br>
For easy launching, "Add to Home Screen"<br>
(iOS/Safari - from the share button)<br>
(Android/Chrome - from the three dots menu)<br>
<br>
If you enjoyed this app, please donate to<br> 
<a href="https://www.giving.sg/singapore-children-s-society"> Singapore Children's Society</a> <br>
or to your favourite charity at <a href="https://giving.sg/">giving.sg</a> <br>
<br>
created by <a href="mailto:bengdj@gmail.com">bengdj@gmail.com</a>
</div>
</td></tr>
<tr><td>
	<div style="font-family: Helvetica,Arial,sans-serif; font-size:20px;text-align:center">
	<a href="./yamseng v0.5_files/yamseng_qrcode.png">
	<img src="./yamseng v0.5_files/yamseng_qrcode.png" loading="lazy" alt="yamseng_qrcode" width="1080" height="1080" style="width:80%;height:auto;">
    </a>
    </div>
</td></tr>
</tbody></table>



</body><div id="shopback-app" style="z-index: 2147483647 !important;"></div></html>